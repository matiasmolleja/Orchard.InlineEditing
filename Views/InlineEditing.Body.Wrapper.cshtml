@using Orchard.ContentManagement;
@using Orchard.Core.Contents;
@using Orchard.Core.Common.Models;
@using Newtonsoft.Json;

@{
    ContentItem contentItem = (ContentItem)Model.ContentItem;
    BodyPart bodyPart = contentItem.As<BodyPart>();
    string escapedContent = Newtonsoft.Json.JsonConvert.SerializeObject(bodyPart.Text);    
}


@if (AuthorizedFor(Permissions.EditContent) && Model.ContentItem.Id > 0)
{
    using (Script.Foot())
    {
        <script type="text/javascript">
            console.log('at the time of adding this is dirtyparts:' + myIEPageVM.dirtyParts().length);
            var bp =  giveMeABodyPart(@contentItem.Id, '@escapedContent', 'bodyPart');
            myIEPageVM.parts().push(bp);
            console.log('bodywarpper' + myIEPageVM.parts().length);

        </script>
    };
    
    @*<p  data-bind="text: function(data) { myPart('@contentItem.Id',data)}">dd</p>*@
    <p data-bind="text: partFromId(@contentItem.Id).contentItemId ">dd</p>

    <div class="inline-editing-content-control" data-bind="visible: editorMode">
        <ul class="actions-controls">
            <li>
                <i class="icon-pencil icon-border"
                   data-bind="css: { iconeditdirty : partFromId(@contentItem.Id).isDirty }">
                </i>
            </li>
            <li>
                @Html.ItemEditLinkWithReturnUrl(T("Dashboard").Text, (ContentItem)Model.ContentItem)
            </li>

        </ul>
    </div>

    <div class="inline-editing-body-control">
        <div class="mce_BodyPart_@contentItem.Id" id="mce_BodyPart_@contentItem.Id">
            @Model.Html
        </div>
    </div>
}
else
{
    @Model.Html
}